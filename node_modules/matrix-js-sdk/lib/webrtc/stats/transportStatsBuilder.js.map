{"version":3,"file":"transportStatsBuilder.js","names":["TransportStatsBuilder","buildReport","report","now","conferenceStatsTransport","isFocus","localUsedCandidate","get","localCandidateId","remoteUsedCandidate","remoteCandidateId","remoteIpAddress","ip","undefined","address","remotePort","port","localIpAddress","localPort","localIp","type","protocol","some","t","push","localCandidateType","candidateType","remoteCandidateType","networkType","rtt","currentRoundTripTime","NaN","exports"],"sources":["../../../src/webrtc/stats/transportStatsBuilder.ts"],"sourcesContent":["import { TransportStats } from \"./transportStats\";\n\nexport class TransportStatsBuilder {\n    public static buildReport(\n        report: RTCStatsReport | undefined,\n        now: RTCIceCandidatePairStats,\n        conferenceStatsTransport: TransportStats[],\n        isFocus: boolean,\n    ): TransportStats[] {\n        const localUsedCandidate = report?.get(now.localCandidateId);\n        const remoteUsedCandidate = report?.get(now.remoteCandidateId);\n\n        // RTCIceCandidateStats\n        // https://w3c.github.io/webrtc-stats/#icecandidate-dict*\n        if (remoteUsedCandidate && localUsedCandidate) {\n            const remoteIpAddress =\n                remoteUsedCandidate.ip !== undefined ? remoteUsedCandidate.ip : remoteUsedCandidate.address;\n            const remotePort = remoteUsedCandidate.port;\n            const ip = `${remoteIpAddress}:${remotePort}`;\n\n            const localIpAddress =\n                localUsedCandidate.ip !== undefined ? localUsedCandidate.ip : localUsedCandidate.address;\n            const localPort = localUsedCandidate.port;\n            const localIp = `${localIpAddress}:${localPort}`;\n\n            const type = remoteUsedCandidate.protocol;\n\n            // Save the address unless it has been saved already.\n            if (\n                !conferenceStatsTransport.some(\n                    (t: TransportStats) => t.ip === ip && t.type === type && t.localIp === localIp,\n                )\n            ) {\n                conferenceStatsTransport.push({\n                    ip,\n                    type,\n                    localIp,\n                    isFocus,\n                    localCandidateType: localUsedCandidate.candidateType,\n                    remoteCandidateType: remoteUsedCandidate.candidateType,\n                    networkType: localUsedCandidate.networkType,\n                    rtt: now.currentRoundTripTime ? now.currentRoundTripTime * 1000 : NaN,\n                } as TransportStats);\n            }\n        }\n        return conferenceStatsTransport;\n    }\n}\n"],"mappings":";;;;;;AAEO,MAAMA,qBAAqB,CAAC;EAC/B,OAAcC,WAAWA,CACrBC,MAAkC,EAClCC,GAA6B,EAC7BC,wBAA0C,EAC1CC,OAAgB,EACA;IAChB,MAAMC,kBAAkB,GAAGJ,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEK,GAAG,CAACJ,GAAG,CAACK,gBAAgB,CAAC;IAC5D,MAAMC,mBAAmB,GAAGP,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEK,GAAG,CAACJ,GAAG,CAACO,iBAAiB,CAAC;;IAE9D;IACA;IACA,IAAID,mBAAmB,IAAIH,kBAAkB,EAAE;MAC3C,MAAMK,eAAe,GACjBF,mBAAmB,CAACG,EAAE,KAAKC,SAAS,GAAGJ,mBAAmB,CAACG,EAAE,GAAGH,mBAAmB,CAACK,OAAO;MAC/F,MAAMC,UAAU,GAAGN,mBAAmB,CAACO,IAAI;MAC3C,MAAMJ,EAAE,GAAI,GAAED,eAAgB,IAAGI,UAAW,EAAC;MAE7C,MAAME,cAAc,GAChBX,kBAAkB,CAACM,EAAE,KAAKC,SAAS,GAAGP,kBAAkB,CAACM,EAAE,GAAGN,kBAAkB,CAACQ,OAAO;MAC5F,MAAMI,SAAS,GAAGZ,kBAAkB,CAACU,IAAI;MACzC,MAAMG,OAAO,GAAI,GAAEF,cAAe,IAAGC,SAAU,EAAC;MAEhD,MAAME,IAAI,GAAGX,mBAAmB,CAACY,QAAQ;;MAEzC;MACA,IACI,CAACjB,wBAAwB,CAACkB,IAAI,CACzBC,CAAiB,IAAKA,CAAC,CAACX,EAAE,KAAKA,EAAE,IAAIW,CAAC,CAACH,IAAI,KAAKA,IAAI,IAAIG,CAAC,CAACJ,OAAO,KAAKA,OAC3E,CAAC,EACH;QACEf,wBAAwB,CAACoB,IAAI,CAAC;UAC1BZ,EAAE;UACFQ,IAAI;UACJD,OAAO;UACPd,OAAO;UACPoB,kBAAkB,EAAEnB,kBAAkB,CAACoB,aAAa;UACpDC,mBAAmB,EAAElB,mBAAmB,CAACiB,aAAa;UACtDE,WAAW,EAAEtB,kBAAkB,CAACsB,WAAW;UAC3CC,GAAG,EAAE1B,GAAG,CAAC2B,oBAAoB,GAAG3B,GAAG,CAAC2B,oBAAoB,GAAG,IAAI,GAAGC;QACtE,CAAmB,CAAC;MACxB;IACJ;IACA,OAAO3B,wBAAwB;EACnC;AACJ;AAAC4B,OAAA,CAAAhC,qBAAA,GAAAA,qBAAA"}