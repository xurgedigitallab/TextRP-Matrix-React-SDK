{"version":3,"file":"IMediaEventContent.js","names":["prepEventContentAsMedia","content","thumbnail","info","thumbnail_url","mxc","file","thumbnail_file","url","Error"],"sources":["../../../src/customisations/models/IMediaEventContent.ts"],"sourcesContent":["/*\r\n * Copyright 2021 The Matrix.org Foundation C.I.C.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *         http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n// TODO: These types should be elsewhere.\r\n\r\nexport interface IEncryptedFile {\r\n    url: string;\r\n    key: {\r\n        alg: string;\r\n        key_ops: string[]; // eslint-disable-line camelcase\r\n        kty: string;\r\n        k: string;\r\n        ext: boolean;\r\n    };\r\n    iv: string;\r\n    hashes: { [alg: string]: string };\r\n    v: string;\r\n}\r\n\r\nexport interface IMediaEventInfo {\r\n    thumbnail_url?: string; // eslint-disable-line camelcase\r\n    thumbnail_file?: IEncryptedFile; // eslint-disable-line camelcase\r\n    thumbnail_info?: {\r\n        // eslint-disable-line camelcase\r\n        mimetype: string;\r\n        w?: number;\r\n        h?: number;\r\n        size?: number;\r\n    };\r\n    mimetype: string;\r\n    w?: number;\r\n    h?: number;\r\n    size?: number;\r\n}\r\n\r\nexport interface IMediaEventContent {\r\n    msgtype: string;\r\n    body?: string;\r\n    filename?: string; // `m.file` optional field\r\n    url?: string; // required on unencrypted media\r\n    file?: IEncryptedFile; // required for *encrypted* media\r\n    info?: IMediaEventInfo;\r\n}\r\n\r\nexport interface IPreparedMedia extends IMediaObject {\r\n    thumbnail?: IMediaObject;\r\n}\r\n\r\nexport interface IMediaObject {\r\n    mxc: string;\r\n    file?: IEncryptedFile;\r\n}\r\n\r\n/**\r\n * Parses an event content body into a prepared media object. This prepared media object\r\n * can be used with other functions to manipulate the media.\r\n * @param {IMediaEventContent} content Unredacted media event content. See interface.\r\n * @returns {IPreparedMedia} A prepared media object.\r\n * @throws Throws if the given content cannot be packaged into a prepared media object.\r\n */\r\nexport function prepEventContentAsMedia(content: Partial<IMediaEventContent>): IPreparedMedia {\r\n    let thumbnail: IMediaObject | undefined;\r\n    if (content?.info?.thumbnail_url) {\r\n        thumbnail = {\r\n            mxc: content.info.thumbnail_url,\r\n            file: content.info.thumbnail_file,\r\n        };\r\n    } else if (content?.info?.thumbnail_file?.url) {\r\n        thumbnail = {\r\n            mxc: content.info.thumbnail_file.url,\r\n            file: content.info.thumbnail_file,\r\n        };\r\n    }\r\n\r\n    if (content?.url) {\r\n        return {\r\n            thumbnail,\r\n            mxc: content.url,\r\n            file: content.file,\r\n        };\r\n    } else if (content?.file?.url) {\r\n        return {\r\n            thumbnail,\r\n            mxc: content.file.url,\r\n            file: content.file,\r\n        };\r\n    }\r\n\r\n    throw new Error(\"Invalid file provided: cannot determine MXC URI. Has it been redacted?\");\r\n}\r\n"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAkDA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASA,uBAAuBA,CAACC,OAAoC,EAAkB;EAC1F,IAAIC,SAAmC;EACvC,IAAID,OAAO,EAAEE,IAAI,EAAEC,aAAa,EAAE;IAC9BF,SAAS,GAAG;MACRG,GAAG,EAAEJ,OAAO,CAACE,IAAI,CAACC,aAAa;MAC/BE,IAAI,EAAEL,OAAO,CAACE,IAAI,CAACI;IACvB,CAAC;EACL,CAAC,MAAM,IAAIN,OAAO,EAAEE,IAAI,EAAEI,cAAc,EAAEC,GAAG,EAAE;IAC3CN,SAAS,GAAG;MACRG,GAAG,EAAEJ,OAAO,CAACE,IAAI,CAACI,cAAc,CAACC,GAAG;MACpCF,IAAI,EAAEL,OAAO,CAACE,IAAI,CAACI;IACvB,CAAC;EACL;EAEA,IAAIN,OAAO,EAAEO,GAAG,EAAE;IACd,OAAO;MACHN,SAAS;MACTG,GAAG,EAAEJ,OAAO,CAACO,GAAG;MAChBF,IAAI,EAAEL,OAAO,CAACK;IAClB,CAAC;EACL,CAAC,MAAM,IAAIL,OAAO,EAAEK,IAAI,EAAEE,GAAG,EAAE;IAC3B,OAAO;MACHN,SAAS;MACTG,GAAG,EAAEJ,OAAO,CAACK,IAAI,CAACE,GAAG;MACrBF,IAAI,EAAEL,OAAO,CAACK;IAClB,CAAC;EACL;EAEA,MAAM,IAAIG,KAAK,CAAC,wEAAwE,CAAC;AAC7F"}