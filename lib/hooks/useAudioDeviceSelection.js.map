{"version":3,"file":"useAudioDeviceSelection.js","names":["_react","require","_languageHandler","_MediaDeviceHandler","_interopRequireWildcard","_requestMediaPermissions","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","_defineProperty2","getOwnPropertyDescriptors","defineProperties","useAudioDeviceSelection","onDeviceChanged","shouldRequestPermissionsRef","useRef","state","setState","useState","devices","device","current","requestMediaPermissions","then","stream","MediaDeviceHandler","getDevices","audioinput","getDefaultDevice","deviceFromSettings","getAudioInput","find","d","deviceId","getTracks","t","stop","setDevice","shouldNotify","instance","MediaDeviceKindEnum","AudioInput","currentDevice","currentDeviceLabel","label","_t","exports"],"sources":["../../src/hooks/useAudioDeviceSelection.ts"],"sourcesContent":["/*\r\nCopyright 2022 The Matrix.org Foundation C.I.C.\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\n    http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License.\r\n*/\r\n\r\nimport { useRef, useState } from \"react\";\r\n\r\nimport { _t } from \"../languageHandler\";\r\nimport MediaDeviceHandler, { MediaDeviceKindEnum } from \"../MediaDeviceHandler\";\r\nimport { requestMediaPermissions } from \"../utils/media/requestMediaPermissions\";\r\n\r\ninterface State {\r\n    devices: MediaDeviceInfo[];\r\n    device: MediaDeviceInfo | null;\r\n}\r\n\r\nexport const useAudioDeviceSelection = (\r\n    onDeviceChanged?: (device: MediaDeviceInfo) => void,\r\n): {\r\n    currentDevice: MediaDeviceInfo | null;\r\n    currentDeviceLabel: string;\r\n    devices: MediaDeviceInfo[];\r\n    setDevice(device: MediaDeviceInfo): void;\r\n} => {\r\n    const shouldRequestPermissionsRef = useRef<boolean>(true);\r\n    const [state, setState] = useState<State>({\r\n        devices: [],\r\n        device: null,\r\n    });\r\n\r\n    if (shouldRequestPermissionsRef.current) {\r\n        shouldRequestPermissionsRef.current = false;\r\n        requestMediaPermissions(false).then((stream: MediaStream | undefined) => {\r\n            MediaDeviceHandler.getDevices().then((devices) => {\r\n                if (!devices) return;\r\n                const { audioinput } = devices;\r\n                MediaDeviceHandler.getDefaultDevice(audioinput);\r\n                const deviceFromSettings = MediaDeviceHandler.getAudioInput();\r\n                const device =\r\n                    audioinput.find((d) => {\r\n                        return d.deviceId === deviceFromSettings;\r\n                    }) || audioinput[0];\r\n                setState({\r\n                    ...state,\r\n                    devices: audioinput,\r\n                    device,\r\n                });\r\n                stream?.getTracks().forEach((t) => t.stop());\r\n            });\r\n        });\r\n    }\r\n\r\n    const setDevice = (device: MediaDeviceInfo): void => {\r\n        const shouldNotify = device.deviceId !== state.device?.deviceId;\r\n        MediaDeviceHandler.instance.setDevice(device.deviceId, MediaDeviceKindEnum.AudioInput);\r\n\r\n        setState({\r\n            ...state,\r\n            device,\r\n        });\r\n\r\n        if (shouldNotify) {\r\n            onDeviceChanged?.(device);\r\n        }\r\n    };\r\n\r\n    return {\r\n        currentDevice: state.device,\r\n        currentDeviceLabel: state.device?.label || _t(\"Default Device\"),\r\n        devices: state.devices,\r\n        setDevice,\r\n    };\r\n};\r\n"],"mappings":";;;;;;;;AAgBA,IAAAA,MAAA,GAAAC,OAAA;AAEA,IAAAC,gBAAA,GAAAD,OAAA;AACA,IAAAE,mBAAA,GAAAC,uBAAA,CAAAH,OAAA;AACA,IAAAI,wBAAA,GAAAJ,OAAA;AAAiF,SAAAK,yBAAAC,WAAA,eAAAC,OAAA,kCAAAC,iBAAA,OAAAD,OAAA,QAAAE,gBAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,WAAA,WAAAA,WAAA,GAAAG,gBAAA,GAAAD,iBAAA,KAAAF,WAAA;AAAA,SAAAH,wBAAAO,GAAA,EAAAJ,WAAA,SAAAA,WAAA,IAAAI,GAAA,IAAAA,GAAA,CAAAC,UAAA,WAAAD,GAAA,QAAAA,GAAA,oBAAAA,GAAA,wBAAAA,GAAA,4BAAAE,OAAA,EAAAF,GAAA,UAAAG,KAAA,GAAAR,wBAAA,CAAAC,WAAA,OAAAO,KAAA,IAAAA,KAAA,CAAAC,GAAA,CAAAJ,GAAA,YAAAG,KAAA,CAAAE,GAAA,CAAAL,GAAA,SAAAM,MAAA,WAAAC,qBAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,GAAA,IAAAX,GAAA,QAAAW,GAAA,kBAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAd,GAAA,EAAAW,GAAA,SAAAI,IAAA,GAAAR,qBAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAV,GAAA,EAAAW,GAAA,cAAAI,IAAA,KAAAA,IAAA,CAAAV,GAAA,IAAAU,IAAA,CAAAC,GAAA,KAAAR,MAAA,CAAAC,cAAA,CAAAH,MAAA,EAAAK,GAAA,EAAAI,IAAA,YAAAT,MAAA,CAAAK,GAAA,IAAAX,GAAA,CAAAW,GAAA,SAAAL,MAAA,CAAAJ,OAAA,GAAAF,GAAA,MAAAG,KAAA,IAAAA,KAAA,CAAAa,GAAA,CAAAhB,GAAA,EAAAM,MAAA,YAAAA,MAAA;AAAA,SAAAW,QAAAC,MAAA,EAAAC,cAAA,QAAAC,IAAA,GAAAZ,MAAA,CAAAY,IAAA,CAAAF,MAAA,OAAAV,MAAA,CAAAa,qBAAA,QAAAC,OAAA,GAAAd,MAAA,CAAAa,qBAAA,CAAAH,MAAA,GAAAC,cAAA,KAAAG,OAAA,GAAAA,OAAA,CAAAC,MAAA,WAAAC,GAAA,WAAAhB,MAAA,CAAAE,wBAAA,CAAAQ,MAAA,EAAAM,GAAA,EAAAC,UAAA,OAAAL,IAAA,CAAAM,IAAA,CAAAC,KAAA,CAAAP,IAAA,EAAAE,OAAA,YAAAF,IAAA;AAAA,SAAAQ,cAAAC,MAAA,aAAAC,CAAA,MAAAA,CAAA,GAAAC,SAAA,CAAAC,MAAA,EAAAF,CAAA,UAAAG,MAAA,WAAAF,SAAA,CAAAD,CAAA,IAAAC,SAAA,CAAAD,CAAA,QAAAA,CAAA,OAAAb,OAAA,CAAAT,MAAA,CAAAyB,MAAA,OAAAC,OAAA,WAAAvB,GAAA,QAAAwB,gBAAA,CAAAjC,OAAA,EAAA2B,MAAA,EAAAlB,GAAA,EAAAsB,MAAA,CAAAtB,GAAA,SAAAH,MAAA,CAAA4B,yBAAA,GAAA5B,MAAA,CAAA6B,gBAAA,CAAAR,MAAA,EAAArB,MAAA,CAAA4B,yBAAA,CAAAH,MAAA,KAAAhB,OAAA,CAAAT,MAAA,CAAAyB,MAAA,GAAAC,OAAA,WAAAvB,GAAA,IAAAH,MAAA,CAAAC,cAAA,CAAAoB,MAAA,EAAAlB,GAAA,EAAAH,MAAA,CAAAE,wBAAA,CAAAuB,MAAA,EAAAtB,GAAA,iBAAAkB,MAAA,IApBjF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAaO,MAAMS,uBAAuB,GAChCC,eAAmD,IAMlD;EACD,MAAMC,2BAA2B,GAAG,IAAAC,aAAM,EAAU,IAAI,CAAC;EACzD,MAAM,CAACC,KAAK,EAAEC,QAAQ,CAAC,GAAG,IAAAC,eAAQ,EAAQ;IACtCC,OAAO,EAAE,EAAE;IACXC,MAAM,EAAE;EACZ,CAAC,CAAC;EAEF,IAAIN,2BAA2B,CAACO,OAAO,EAAE;IACrCP,2BAA2B,CAACO,OAAO,GAAG,KAAK;IAC3C,IAAAC,gDAAuB,EAAC,KAAK,CAAC,CAACC,IAAI,CAAEC,MAA+B,IAAK;MACrEC,2BAAkB,CAACC,UAAU,CAAC,CAAC,CAACH,IAAI,CAAEJ,OAAO,IAAK;QAC9C,IAAI,CAACA,OAAO,EAAE;QACd,MAAM;UAAEQ;QAAW,CAAC,GAAGR,OAAO;QAC9BM,2BAAkB,CAACG,gBAAgB,CAACD,UAAU,CAAC;QAC/C,MAAME,kBAAkB,GAAGJ,2BAAkB,CAACK,aAAa,CAAC,CAAC;QAC7D,MAAMV,MAAM,GACRO,UAAU,CAACI,IAAI,CAAEC,CAAC,IAAK;UACnB,OAAOA,CAAC,CAACC,QAAQ,KAAKJ,kBAAkB;QAC5C,CAAC,CAAC,IAAIF,UAAU,CAAC,CAAC,CAAC;QACvBV,QAAQ,CAAAf,aAAA,CAAAA,aAAA,KACDc,KAAK;UACRG,OAAO,EAAEQ,UAAU;UACnBP;QAAM,EACT,CAAC;QACFI,MAAM,EAAEU,SAAS,CAAC,CAAC,CAAC1B,OAAO,CAAE2B,CAAC,IAAKA,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC;MAChD,CAAC,CAAC;IACN,CAAC,CAAC;EACN;EAEA,MAAMC,SAAS,GAAIjB,MAAuB,IAAW;IACjD,MAAMkB,YAAY,GAAGlB,MAAM,CAACa,QAAQ,KAAKjB,KAAK,CAACI,MAAM,EAAEa,QAAQ;IAC/DR,2BAAkB,CAACc,QAAQ,CAACF,SAAS,CAACjB,MAAM,CAACa,QAAQ,EAAEO,uCAAmB,CAACC,UAAU,CAAC;IAEtFxB,QAAQ,CAAAf,aAAA,CAAAA,aAAA,KACDc,KAAK;MACRI;IAAM,EACT,CAAC;IAEF,IAAIkB,YAAY,EAAE;MACdzB,eAAe,GAAGO,MAAM,CAAC;IAC7B;EACJ,CAAC;EAED,OAAO;IACHsB,aAAa,EAAE1B,KAAK,CAACI,MAAM;IAC3BuB,kBAAkB,EAAE3B,KAAK,CAACI,MAAM,EAAEwB,KAAK,IAAI,IAAAC,mBAAE,EAAC,gBAAgB,CAAC;IAC/D1B,OAAO,EAAEH,KAAK,CAACG,OAAO;IACtBkB;EACJ,CAAC;AACL,CAAC;AAACS,OAAA,CAAAlC,uBAAA,GAAAA,uBAAA"}