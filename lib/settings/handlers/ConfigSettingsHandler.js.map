{"version":3,"file":"ConfigSettingsHandler.js","names":["_utils","require","_SettingsHandler","_interopRequireDefault","_SdkConfig","_SnakedObject","ConfigSettingsHandler","SettingsHandler","constructor","featureNames","getValue","settingName","roomId","config","SnakedObject","SdkConfig","get","includes","labsConfig","val","isNullOrUndefined","settingsConfig","setValue","newValue","Error","canSetValue","isSupported","exports","default"],"sources":["../../../src/settings/handlers/ConfigSettingsHandler.ts"],"sourcesContent":["/*\r\nCopyright 2017 Travis Ralston\r\nCopyright 2019, 2020 The Matrix.org Foundation C.I.C.\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\n    http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License.\r\n*/\r\n\r\nimport { isNullOrUndefined } from \"matrix-js-sdk/src/utils\";\r\n\r\nimport SettingsHandler from \"./SettingsHandler\";\r\nimport SdkConfig from \"../../SdkConfig\";\r\nimport { SnakedObject } from \"../../utils/SnakedObject\";\r\nimport { IConfigOptions } from \"../../IConfigOptions\";\r\n\r\n/**\r\n * Gets and sets settings at the \"config\" level. This handler does not make use of the\r\n * roomId parameter.\r\n */\r\nexport default class ConfigSettingsHandler extends SettingsHandler {\r\n    public constructor(private featureNames: string[]) {\r\n        super();\r\n    }\r\n\r\n    public getValue(settingName: string, roomId: string): any {\r\n        const config = new SnakedObject<IConfigOptions>(SdkConfig.get());\r\n\r\n        if (this.featureNames.includes(settingName)) {\r\n            const labsConfig = config.get(\"features\") || {};\r\n            const val = labsConfig[settingName];\r\n            if (isNullOrUndefined(val)) return null; // no definition at this level\r\n            if (val === true || val === false) return val; // new style: mapped as a boolean\r\n            if (val === \"enable\") return true; // backwards compat\r\n            if (val === \"disable\") return false; // backwards compat\r\n            if (val === \"labs\") return null; // backwards compat, no override\r\n            return null; // fallback in the case of invalid input\r\n        }\r\n\r\n        // Special case themes\r\n        if (settingName === \"theme\") {\r\n            return config.get(\"default_theme\");\r\n        }\r\n\r\n        const settingsConfig = config.get(\"setting_defaults\");\r\n        if (!settingsConfig || isNullOrUndefined(settingsConfig[settingName])) return null;\r\n        return settingsConfig[settingName];\r\n    }\r\n\r\n    public async setValue(settingName: string, roomId: string, newValue: any): Promise<void> {\r\n        throw new Error(\"Cannot change settings at the config level\");\r\n    }\r\n\r\n    public canSetValue(settingName: string, roomId: string): boolean {\r\n        return false;\r\n    }\r\n\r\n    public isSupported(): boolean {\r\n        return true; // SdkConfig is always there\r\n    }\r\n}\r\n"],"mappings":";;;;;;;AAiBA,IAAAA,MAAA,GAAAC,OAAA;AAEA,IAAAC,gBAAA,GAAAC,sBAAA,CAAAF,OAAA;AACA,IAAAG,UAAA,GAAAD,sBAAA,CAAAF,OAAA;AACA,IAAAI,aAAA,GAAAJ,OAAA;AArBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AASA;AACA;AACA;AACA;AACe,MAAMK,qBAAqB,SAASC,wBAAe,CAAC;EACxDC,WAAWA,CAASC,YAAsB,EAAE;IAC/C,KAAK,CAAC,CAAC;IAAC,KADeA,YAAsB,GAAtBA,YAAsB;EAEjD;EAEOC,QAAQA,CAACC,WAAmB,EAAEC,MAAc,EAAO;IACtD,MAAMC,MAAM,GAAG,IAAIC,0BAAY,CAAiBC,kBAAS,CAACC,GAAG,CAAC,CAAC,CAAC;IAEhE,IAAI,IAAI,CAACP,YAAY,CAACQ,QAAQ,CAACN,WAAW,CAAC,EAAE;MACzC,MAAMO,UAAU,GAAGL,MAAM,CAACG,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;MAC/C,MAAMG,GAAG,GAAGD,UAAU,CAACP,WAAW,CAAC;MACnC,IAAI,IAAAS,wBAAiB,EAACD,GAAG,CAAC,EAAE,OAAO,IAAI,CAAC,CAAC;MACzC,IAAIA,GAAG,KAAK,IAAI,IAAIA,GAAG,KAAK,KAAK,EAAE,OAAOA,GAAG,CAAC,CAAC;MAC/C,IAAIA,GAAG,KAAK,QAAQ,EAAE,OAAO,IAAI,CAAC,CAAC;MACnC,IAAIA,GAAG,KAAK,SAAS,EAAE,OAAO,KAAK,CAAC,CAAC;MACrC,IAAIA,GAAG,KAAK,MAAM,EAAE,OAAO,IAAI,CAAC,CAAC;MACjC,OAAO,IAAI,CAAC,CAAC;IACjB;;IAEA;IACA,IAAIR,WAAW,KAAK,OAAO,EAAE;MACzB,OAAOE,MAAM,CAACG,GAAG,CAAC,eAAe,CAAC;IACtC;IAEA,MAAMK,cAAc,GAAGR,MAAM,CAACG,GAAG,CAAC,kBAAkB,CAAC;IACrD,IAAI,CAACK,cAAc,IAAI,IAAAD,wBAAiB,EAACC,cAAc,CAACV,WAAW,CAAC,CAAC,EAAE,OAAO,IAAI;IAClF,OAAOU,cAAc,CAACV,WAAW,CAAC;EACtC;EAEA,MAAaW,QAAQA,CAACX,WAAmB,EAAEC,MAAc,EAAEW,QAAa,EAAiB;IACrF,MAAM,IAAIC,KAAK,CAAC,4CAA4C,CAAC;EACjE;EAEOC,WAAWA,CAACd,WAAmB,EAAEC,MAAc,EAAW;IAC7D,OAAO,KAAK;EAChB;EAEOc,WAAWA,CAAA,EAAY;IAC1B,OAAO,IAAI,CAAC,CAAC;EACjB;AACJ;AAACC,OAAA,CAAAC,OAAA,GAAAtB,qBAAA"}