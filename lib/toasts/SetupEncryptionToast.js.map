{"version":3,"file":"SetupEncryptionToast.js","names":["_Modal","_interopRequireDefault","require","_languageHandler","_DeviceListener","_SetupEncryptionDialog","_SecurityManager","_ToastStore","_GenericToast","_Security","_Spinner","TOAST_KEY","getTitle","kind","Kind","SET_UP_ENCRYPTION","_t","UPGRADE_ENCRYPTION","VERIFY_THIS_SESSION","getIcon","getSetupCaption","getDescription","exports","onReject","DeviceListener","sharedInstance","dismissEncryptionSetup","showToast","SecurityCustomisations","setupEncryptionNeeded","onAccept","Modal","createDialog","SetupEncryptionDialog","undefined","modal","Spinner","accessSecretStorage","close","ToastStore","addOrReplaceToast","key","title","icon","props","description","acceptLabel","rejectLabel","component","GenericToast","priority","hideToast","dismissToast"],"sources":["../../src/toasts/SetupEncryptionToast.ts"],"sourcesContent":["/*\r\nCopyright 2020 The Matrix.org Foundation C.I.C.\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\nhttp://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License.\r\n*/\r\n\r\nimport Modal from \"../Modal\";\r\nimport { _t } from \"../languageHandler\";\r\nimport DeviceListener from \"../DeviceListener\";\r\nimport SetupEncryptionDialog from \"../components/views/dialogs/security/SetupEncryptionDialog\";\r\nimport { accessSecretStorage } from \"../SecurityManager\";\r\nimport ToastStore from \"../stores/ToastStore\";\r\nimport GenericToast from \"../components/views/toasts/GenericToast\";\r\nimport SecurityCustomisations from \"../customisations/Security\";\r\nimport Spinner from \"../components/views/elements/Spinner\";\r\n\r\nconst TOAST_KEY = \"setupencryption\";\r\n\r\nconst getTitle = (kind: Kind): string => {\r\n    switch (kind) {\r\n        case Kind.SET_UP_ENCRYPTION:\r\n            return _t(\"Set up Secure Backup\");\r\n        case Kind.UPGRADE_ENCRYPTION:\r\n            return _t(\"Encryption upgrade available\");\r\n        case Kind.VERIFY_THIS_SESSION:\r\n            return _t(\"Verify this session\");\r\n    }\r\n};\r\n\r\nconst getIcon = (kind: Kind): string => {\r\n    switch (kind) {\r\n        case Kind.SET_UP_ENCRYPTION:\r\n        case Kind.UPGRADE_ENCRYPTION:\r\n            return \"secure_backup\";\r\n        case Kind.VERIFY_THIS_SESSION:\r\n            return \"verification_warning\";\r\n    }\r\n};\r\n\r\nconst getSetupCaption = (kind: Kind): string => {\r\n    switch (kind) {\r\n        case Kind.SET_UP_ENCRYPTION:\r\n            return _t(\"Continue\");\r\n        case Kind.UPGRADE_ENCRYPTION:\r\n            return _t(\"Upgrade\");\r\n        case Kind.VERIFY_THIS_SESSION:\r\n            return _t(\"Verify\");\r\n    }\r\n};\r\n\r\nconst getDescription = (kind: Kind): string => {\r\n    switch (kind) {\r\n        case Kind.SET_UP_ENCRYPTION:\r\n        case Kind.UPGRADE_ENCRYPTION:\r\n            return _t(\"Safeguard against losing access to encrypted messages & data\");\r\n        case Kind.VERIFY_THIS_SESSION:\r\n            return _t(\"Other users may not trust it\");\r\n    }\r\n};\r\n\r\nexport enum Kind {\r\n    SET_UP_ENCRYPTION = \"set_up_encryption\",\r\n    UPGRADE_ENCRYPTION = \"upgrade_encryption\",\r\n    VERIFY_THIS_SESSION = \"verify_this_session\",\r\n}\r\n\r\nconst onReject = (): void => {\r\n    DeviceListener.sharedInstance().dismissEncryptionSetup();\r\n};\r\n\r\nexport const showToast = (kind: Kind): void => {\r\n    if (SecurityCustomisations.setupEncryptionNeeded?.(kind)) {\r\n        return;\r\n    }\r\n\r\n    const onAccept = async (): Promise<void> => {\r\n        if (kind === Kind.VERIFY_THIS_SESSION) {\r\n            Modal.createDialog(SetupEncryptionDialog, {}, undefined, /* priority = */ false, /* static = */ true);\r\n        } else {\r\n            const modal = Modal.createDialog(\r\n                Spinner,\r\n                undefined,\r\n                \"mx_Dialog_spinner\",\r\n                /* priority */ false,\r\n                /* static */ true,\r\n            );\r\n            try {\r\n                await accessSecretStorage();\r\n            } finally {\r\n                modal.close();\r\n            }\r\n        }\r\n    };\r\n\r\n    ToastStore.sharedInstance().addOrReplaceToast({\r\n        key: TOAST_KEY,\r\n        title: getTitle(kind),\r\n        icon: getIcon(kind),\r\n        props: {\r\n            description: getDescription(kind),\r\n            acceptLabel: getSetupCaption(kind),\r\n            onAccept,\r\n            rejectLabel: _t(\"Later\"),\r\n            onReject,\r\n        },\r\n        component: GenericToast,\r\n        priority: kind === Kind.VERIFY_THIS_SESSION ? 95 : 40,\r\n    });\r\n};\r\n\r\nexport const hideToast = (): void => {\r\n    ToastStore.sharedInstance().dismissToast(TOAST_KEY);\r\n};\r\n"],"mappings":"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"}