{"version":3,"file":"index.js","names":["DefaultOptions","maxCount","speed","frameInterval","alpha","gradient","exports","Confetti","constructor","options","_this","_defineProperty2","default","window","requestAnimationFrame","Date","now","canvas","timeout","arguments","length","undefined","context","getContext","particles","count","push","resetParticle","width","height","isRunning","runAnimation","setTimeout","stop","particle","color","colors","Math","random","color2","x","y","diameter","tilt","tiltAngleIncrement","tiltAngle","PI","clearRect","delta","lastFrameTime","supportsAnimationFrame","updateParticles","drawParticles","x2","y2","beginPath","lineWidth","createLinearGradient","addColorStop","strokeStyle","moveTo","lineTo","stroke","waveAngle","i","sin","cos","splice","_objectSpread"],"sources":["../../../src/effects/confetti/index.ts"],"sourcesContent":["/*\r\n Copyright 2020 Nurjin Jafar\r\n Copyright 2020 Nordeck IT + Consulting GmbH.\r\n Copyright 2023 The Matrix.org Foundation C.I.C.\r\n\r\n Licensed under the Apache License, Version 2.0 (the \"License\");\r\n you may not use this file except in compliance with the License.\r\n You may obtain a copy of the License at\r\n\r\n http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n Unless required by applicable law or agreed to in writing, software\r\n distributed under the License is distributed on an \"AS IS\" BASIS,\r\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n See the License for the specific language governing permissions and\r\n limitations under the License.\r\n */\r\nimport ICanvasEffect from \"../ICanvasEffect\";\r\n\r\nexport type ConfettiOptions = {\r\n    /**\r\n     * max confetti count\r\n     */\r\n    maxCount: number;\r\n    /**\r\n     * particle animation speed\r\n     */\r\n    speed: number;\r\n    /**\r\n     * the confetti animation frame interval in milliseconds\r\n     */\r\n    frameInterval: number;\r\n    /**\r\n     * the alpha opacity of the confetti (between 0 and 1, where 1 is opaque and 0 is invisible)\r\n     */\r\n    alpha: number;\r\n    /**\r\n     * use gradient instead of solid particle color\r\n     */\r\n    gradient: boolean;\r\n};\r\n\r\ntype ConfettiParticle = {\r\n    color: string;\r\n    color2: string;\r\n    x: number;\r\n    y: number;\r\n    diameter: number;\r\n    tilt: number;\r\n    tiltAngleIncrement: number;\r\n    tiltAngle: number;\r\n};\r\n\r\nexport const DefaultOptions: ConfettiOptions = {\r\n    maxCount: 150,\r\n    speed: 3,\r\n    frameInterval: 15,\r\n    alpha: 1.0,\r\n    gradient: false,\r\n};\r\n\r\nexport default class Confetti implements ICanvasEffect {\r\n    private readonly options: ConfettiOptions;\r\n\r\n    public constructor(options: { [key: string]: any }) {\r\n        this.options = { ...DefaultOptions, ...options };\r\n    }\r\n\r\n    private context: CanvasRenderingContext2D | null = null;\r\n    private supportsAnimationFrame = window.requestAnimationFrame;\r\n    private colors = [\r\n        \"rgba(30,144,255,\",\r\n        \"rgba(107,142,35,\",\r\n        \"rgba(255,215,0,\",\r\n        \"rgba(255,192,203,\",\r\n        \"rgba(106,90,205,\",\r\n        \"rgba(173,216,230,\",\r\n        \"rgba(238,130,238,\",\r\n        \"rgba(152,251,152,\",\r\n        \"rgba(70,130,180,\",\r\n        \"rgba(244,164,96,\",\r\n        \"rgba(210,105,30,\",\r\n        \"rgba(220,20,60,\",\r\n    ];\r\n\r\n    private lastFrameTime = Date.now();\r\n    private particles: Array<ConfettiParticle> = [];\r\n    private waveAngle = 0;\r\n\r\n    public isRunning = false;\r\n\r\n    public start = async (canvas: HTMLCanvasElement, timeout = 3000): Promise<void> => {\r\n        if (!canvas) {\r\n            return;\r\n        }\r\n        this.context = canvas.getContext(\"2d\");\r\n        this.particles = [];\r\n        const count = this.options.maxCount;\r\n        while (this.particles.length < count) {\r\n            this.particles.push(this.resetParticle({} as ConfettiParticle, canvas.width, canvas.height));\r\n        }\r\n        this.isRunning = true;\r\n        this.runAnimation();\r\n        if (timeout) {\r\n            window.setTimeout(this.stop, timeout);\r\n        }\r\n    };\r\n\r\n    public stop = async (): Promise<void> => {\r\n        this.isRunning = false;\r\n    };\r\n\r\n    private resetParticle = (particle: ConfettiParticle, width: number, height: number): ConfettiParticle => {\r\n        particle.color = this.colors[(Math.random() * this.colors.length) | 0] + (this.options.alpha + \")\");\r\n        if (this.options.gradient) {\r\n            particle.color2 = this.colors[(Math.random() * this.colors.length) | 0] + (this.options.alpha + \")\");\r\n        } else {\r\n            particle.color2 = particle.color;\r\n        }\r\n        particle.x = Math.random() * width;\r\n        particle.y = Math.random() * -height;\r\n        particle.diameter = Math.random() * 10 + 5;\r\n        particle.tilt = Math.random() * -10;\r\n        particle.tiltAngleIncrement = Math.random() * 0.07 + 0.05;\r\n        particle.tiltAngle = Math.random() * Math.PI;\r\n        return particle;\r\n    };\r\n\r\n    private runAnimation = (): void => {\r\n        if (!this.context || !this.context.canvas) {\r\n            return;\r\n        }\r\n        if (this.particles.length === 0) {\r\n            this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\r\n        } else {\r\n            const now = Date.now();\r\n            const delta = now - this.lastFrameTime;\r\n            if (!this.supportsAnimationFrame || delta > this.options.frameInterval) {\r\n                this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\r\n                this.updateParticles();\r\n                this.drawParticles(this.context);\r\n                this.lastFrameTime = now - (delta % this.options.frameInterval);\r\n            }\r\n            requestAnimationFrame(this.runAnimation);\r\n        }\r\n    };\r\n\r\n    private drawParticles = (context: CanvasRenderingContext2D): void => {\r\n        if (!this.context || !this.context.canvas) {\r\n            return;\r\n        }\r\n        let x;\r\n        let x2;\r\n        let y2;\r\n        for (const particle of this.particles) {\r\n            this.context.beginPath();\r\n            context.lineWidth = particle.diameter;\r\n            x2 = particle.x + particle.tilt;\r\n            x = x2 + particle.diameter / 2;\r\n            y2 = particle.y + particle.tilt + particle.diameter / 2;\r\n            if (this.options.gradient) {\r\n                const gradient = context.createLinearGradient(x, particle.y, x2, y2);\r\n                gradient.addColorStop(0, particle.color);\r\n                gradient.addColorStop(1.0, particle.color2);\r\n                context.strokeStyle = gradient;\r\n            } else {\r\n                context.strokeStyle = particle.color;\r\n            }\r\n            context.moveTo(x, particle.y);\r\n            context.lineTo(x2, y2);\r\n            context.stroke();\r\n        }\r\n    };\r\n\r\n    private updateParticles = (): void => {\r\n        if (!this.context || !this.context.canvas) {\r\n            return;\r\n        }\r\n        const width = this.context.canvas.width;\r\n        const height = this.context.canvas.height;\r\n        let particle: ConfettiParticle;\r\n        this.waveAngle += 0.01;\r\n        for (let i = 0; i < this.particles.length; i++) {\r\n            particle = this.particles[i];\r\n            if (!this.isRunning && particle.y < -15) {\r\n                particle.y = height + 100;\r\n            } else {\r\n                particle.tiltAngle += particle.tiltAngleIncrement;\r\n                particle.x += Math.sin(this.waveAngle) - 0.5;\r\n                particle.y += (Math.cos(this.waveAngle) + particle.diameter + this.options.speed) * 0.5;\r\n                particle.tilt = Math.sin(particle.tiltAngle) * 15;\r\n            }\r\n            if (particle.x > width + 20 || particle.x < -20 || particle.y > height) {\r\n                if (this.isRunning && this.particles.length <= this.options.maxCount) {\r\n                    this.resetParticle(particle, width, height);\r\n                } else {\r\n                    this.particles.splice(i, 1);\r\n                    i--;\r\n                }\r\n            }\r\n        }\r\n    };\r\n}\r\n"],"mappings":"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"}