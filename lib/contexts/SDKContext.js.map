{"version":3,"file":"SDKContext.js","names":["_react","require","_dispatcher","_interopRequireDefault","_LegacyCallHandler","_PosthogAnalytics","_SlidingSyncManager","_AccountPasswordStore","_MemberListStore","_RoomNotificationStateStore","_RightPanelStore","_RoomViewStore","_SpaceStore","_TypingStore","_UserProfilesStore","_WidgetLayoutStore","_WidgetPermissionStore","_WidgetStore","_voiceBroadcast","SDKContext","createContext","exports","displayName","SdkContextClass","constructor","_defineProperty2","default","constructEagerStores","roomViewStore","legacyCallHandler","LegacyCallHandler","instance","rightPanelStore","RightPanelStore","roomNotificationStateStore","RoomNotificationStateStore","RoomViewStore","defaultDispatcher","widgetLayoutStore","WidgetLayoutStore","widgetPermissionStore","WidgetPermissionStore","widgetStore","WidgetStore","posthogAnalytics","PosthogAnalytics","memberListStore","MemberListStore","slidingSyncManager","SlidingSyncManager","spaceStore","SpaceStore","typingStore","TypingStore","window","mxTypingStore","voiceBroadcastRecordingsStore","_VoiceBroadcastRecordingsStore","VoiceBroadcastRecordingsStore","voiceBroadcastPreRecordingStore","_VoiceBroadcastPreRecordingStore","VoiceBroadcastPreRecordingStore","voiceBroadcastPlaybacksStore","_VoiceBroadcastPlaybacksStore","VoiceBroadcastPlaybacksStore","accountPasswordStore","AccountPasswordStore","userProfilesStore","client","Error","UserProfilesStore","onLoggedOut","undefined"],"sources":["../../src/contexts/SDKContext.ts"],"sourcesContent":["/*\r\nCopyright 2022 The Matrix.org Foundation C.I.C.\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\n    http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License.\r\n*/\r\n\r\nimport { MatrixClient } from \"matrix-js-sdk/src/matrix\";\r\nimport { createContext } from \"react\";\r\n\r\nimport defaultDispatcher from \"../dispatcher/dispatcher\";\r\nimport LegacyCallHandler from \"../LegacyCallHandler\";\r\nimport { PosthogAnalytics } from \"../PosthogAnalytics\";\r\nimport { SlidingSyncManager } from \"../SlidingSyncManager\";\r\nimport { AccountPasswordStore } from \"../stores/AccountPasswordStore\";\r\nimport { MemberListStore } from \"../stores/MemberListStore\";\r\nimport { RoomNotificationStateStore } from \"../stores/notifications/RoomNotificationStateStore\";\r\nimport RightPanelStore from \"../stores/right-panel/RightPanelStore\";\r\nimport { RoomViewStore } from \"../stores/RoomViewStore\";\r\nimport SpaceStore, { SpaceStoreClass } from \"../stores/spaces/SpaceStore\";\r\nimport TypingStore from \"../stores/TypingStore\";\r\nimport { UserProfilesStore } from \"../stores/UserProfilesStore\";\r\nimport { WidgetLayoutStore } from \"../stores/widgets/WidgetLayoutStore\";\r\nimport { WidgetPermissionStore } from \"../stores/widgets/WidgetPermissionStore\";\r\nimport WidgetStore from \"../stores/WidgetStore\";\r\nimport {\r\n    VoiceBroadcastPlaybacksStore,\r\n    VoiceBroadcastPreRecordingStore,\r\n    VoiceBroadcastRecordingsStore,\r\n} from \"../voice-broadcast\";\r\n\r\n// This context is available to components under MatrixChat,\r\n// the context must not be used by components outside a SdkContextClass tree.\r\n// This assertion allows us to make the type not nullable.\r\nexport const SDKContext = createContext<SdkContextClass>(null as any);\r\nSDKContext.displayName = \"SDKContext\";\r\n\r\n/**\r\n * A class which lazily initialises stores as and when they are requested, ensuring they remain\r\n * as singletons scoped to this object.\r\n */\r\nexport class SdkContextClass {\r\n    /**\r\n     * The global SdkContextClass instance. This is a temporary measure whilst so many stores remain global\r\n     * as well. Over time, these stores should accept a `SdkContextClass` instance in their constructor.\r\n     * When all stores do this, this static variable can be deleted.\r\n     */\r\n    public static readonly instance = new SdkContextClass();\r\n\r\n    // Optional as we don't have a client on initial load if unregistered. This should be set\r\n    // when the MatrixClient is first acquired in the dispatcher event Action.OnLoggedIn.\r\n    // It is only safe to set this once, as updating this value will NOT notify components using\r\n    // this Context.\r\n    public client?: MatrixClient;\r\n\r\n    // All protected fields to make it easier to derive test stores\r\n    protected _WidgetPermissionStore?: WidgetPermissionStore;\r\n    protected _MemberListStore?: MemberListStore;\r\n    protected _RightPanelStore?: RightPanelStore;\r\n    protected _RoomNotificationStateStore?: RoomNotificationStateStore;\r\n    protected _RoomViewStore?: RoomViewStore;\r\n    protected _WidgetLayoutStore?: WidgetLayoutStore;\r\n    protected _WidgetStore?: WidgetStore;\r\n    protected _PosthogAnalytics?: PosthogAnalytics;\r\n    protected _SlidingSyncManager?: SlidingSyncManager;\r\n    protected _SpaceStore?: SpaceStoreClass;\r\n    protected _LegacyCallHandler?: LegacyCallHandler;\r\n    protected _TypingStore?: TypingStore;\r\n    protected _VoiceBroadcastRecordingsStore?: VoiceBroadcastRecordingsStore;\r\n    protected _VoiceBroadcastPreRecordingStore?: VoiceBroadcastPreRecordingStore;\r\n    protected _VoiceBroadcastPlaybacksStore?: VoiceBroadcastPlaybacksStore;\r\n    protected _AccountPasswordStore?: AccountPasswordStore;\r\n    protected _UserProfilesStore?: UserProfilesStore;\r\n\r\n    /**\r\n     * Automatically construct stores which need to be created eagerly so they can register with\r\n     * the dispatcher.\r\n     */\r\n    public constructEagerStores(): void {\r\n        this._RoomViewStore = this.roomViewStore;\r\n    }\r\n\r\n    public get legacyCallHandler(): LegacyCallHandler {\r\n        if (!this._LegacyCallHandler) {\r\n            this._LegacyCallHandler = LegacyCallHandler.instance;\r\n        }\r\n        return this._LegacyCallHandler;\r\n    }\r\n    public get rightPanelStore(): RightPanelStore {\r\n        if (!this._RightPanelStore) {\r\n            this._RightPanelStore = RightPanelStore.instance;\r\n        }\r\n        return this._RightPanelStore;\r\n    }\r\n    public get roomNotificationStateStore(): RoomNotificationStateStore {\r\n        if (!this._RoomNotificationStateStore) {\r\n            this._RoomNotificationStateStore = RoomNotificationStateStore.instance;\r\n        }\r\n        return this._RoomNotificationStateStore;\r\n    }\r\n    public get roomViewStore(): RoomViewStore {\r\n        if (!this._RoomViewStore) {\r\n            this._RoomViewStore = new RoomViewStore(defaultDispatcher, this);\r\n        }\r\n        return this._RoomViewStore;\r\n    }\r\n    public get widgetLayoutStore(): WidgetLayoutStore {\r\n        if (!this._WidgetLayoutStore) {\r\n            this._WidgetLayoutStore = WidgetLayoutStore.instance;\r\n        }\r\n        return this._WidgetLayoutStore;\r\n    }\r\n    public get widgetPermissionStore(): WidgetPermissionStore {\r\n        if (!this._WidgetPermissionStore) {\r\n            this._WidgetPermissionStore = new WidgetPermissionStore(this);\r\n        }\r\n        return this._WidgetPermissionStore;\r\n    }\r\n    public get widgetStore(): WidgetStore {\r\n        if (!this._WidgetStore) {\r\n            this._WidgetStore = WidgetStore.instance;\r\n        }\r\n        return this._WidgetStore;\r\n    }\r\n    public get posthogAnalytics(): PosthogAnalytics {\r\n        if (!this._PosthogAnalytics) {\r\n            this._PosthogAnalytics = PosthogAnalytics.instance;\r\n        }\r\n        return this._PosthogAnalytics;\r\n    }\r\n    public get memberListStore(): MemberListStore {\r\n        if (!this._MemberListStore) {\r\n            this._MemberListStore = new MemberListStore(this);\r\n        }\r\n        return this._MemberListStore;\r\n    }\r\n    public get slidingSyncManager(): SlidingSyncManager {\r\n        if (!this._SlidingSyncManager) {\r\n            this._SlidingSyncManager = SlidingSyncManager.instance;\r\n        }\r\n        return this._SlidingSyncManager;\r\n    }\r\n    public get spaceStore(): SpaceStoreClass {\r\n        if (!this._SpaceStore) {\r\n            this._SpaceStore = SpaceStore.instance;\r\n        }\r\n        return this._SpaceStore;\r\n    }\r\n    public get typingStore(): TypingStore {\r\n        if (!this._TypingStore) {\r\n            this._TypingStore = new TypingStore(this);\r\n            window.mxTypingStore = this._TypingStore;\r\n        }\r\n        return this._TypingStore;\r\n    }\r\n\r\n    public get voiceBroadcastRecordingsStore(): VoiceBroadcastRecordingsStore {\r\n        if (!this._VoiceBroadcastRecordingsStore) {\r\n            this._VoiceBroadcastRecordingsStore = new VoiceBroadcastRecordingsStore();\r\n        }\r\n        return this._VoiceBroadcastRecordingsStore;\r\n    }\r\n\r\n    public get voiceBroadcastPreRecordingStore(): VoiceBroadcastPreRecordingStore {\r\n        if (!this._VoiceBroadcastPreRecordingStore) {\r\n            this._VoiceBroadcastPreRecordingStore = new VoiceBroadcastPreRecordingStore();\r\n        }\r\n        return this._VoiceBroadcastPreRecordingStore;\r\n    }\r\n\r\n    public get voiceBroadcastPlaybacksStore(): VoiceBroadcastPlaybacksStore {\r\n        if (!this._VoiceBroadcastPlaybacksStore) {\r\n            this._VoiceBroadcastPlaybacksStore = new VoiceBroadcastPlaybacksStore(this.voiceBroadcastRecordingsStore);\r\n        }\r\n        return this._VoiceBroadcastPlaybacksStore;\r\n    }\r\n\r\n    public get accountPasswordStore(): AccountPasswordStore {\r\n        if (!this._AccountPasswordStore) {\r\n            this._AccountPasswordStore = new AccountPasswordStore();\r\n        }\r\n        return this._AccountPasswordStore;\r\n    }\r\n\r\n    public get userProfilesStore(): UserProfilesStore {\r\n        if (!this.client) {\r\n            throw new Error(\"Unable to create UserProfilesStore without a client\");\r\n        }\r\n\r\n        if (!this._UserProfilesStore) {\r\n            this._UserProfilesStore = new UserProfilesStore(this.client);\r\n        }\r\n\r\n        return this._UserProfilesStore;\r\n    }\r\n\r\n    public onLoggedOut(): void {\r\n        this._UserProfilesStore = undefined;\r\n    }\r\n}\r\n"],"mappings":"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"}