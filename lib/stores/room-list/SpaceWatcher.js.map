{"version":3,"file":"SpaceWatcher.js","names":["_SpaceFilterCondition","require","_SpaceStore","_interopRequireDefault","_spaces","SpaceWatcher","constructor","store","_this","_defineProperty2","default","SpaceFilterCondition","SpaceStore","instance","activeSpace","allRoomsInHome","arguments","length","undefined","neededFilter","needsFilter","updateFilter","addFilter","filter","removeFilter","onSelectedSpaceUpdated","updateSpace","on","UPDATE_SELECTED_SPACE","UPDATE_HOME_BEHAVIOUR","onHomeBehaviourUpdated","spaceKey","MetaSpace","Home","exports"],"sources":["../../../src/stores/room-list/SpaceWatcher.ts"],"sourcesContent":["/*\r\nCopyright 2021 The Matrix.org Foundation C.I.C.\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\n    http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License.\r\n*/\r\n\r\nimport { RoomListStore as Interface } from \"./Interface\";\r\nimport { SpaceFilterCondition } from \"./filters/SpaceFilterCondition\";\r\nimport SpaceStore from \"../spaces/SpaceStore\";\r\nimport { MetaSpace, SpaceKey, UPDATE_HOME_BEHAVIOUR, UPDATE_SELECTED_SPACE } from \"../spaces\";\r\n\r\n/**\r\n * Watches for changes in spaces to manage the filter on the provided RoomListStore\r\n */\r\nexport class SpaceWatcher {\r\n    private readonly filter = new SpaceFilterCondition();\r\n    // we track these separately to the SpaceStore as we need to observe transitions\r\n    private activeSpace: SpaceKey = SpaceStore.instance.activeSpace;\r\n    private allRoomsInHome: boolean = SpaceStore.instance.allRoomsInHome;\r\n\r\n    public constructor(private store: Interface) {\r\n        if (SpaceWatcher.needsFilter(this.activeSpace, this.allRoomsInHome)) {\r\n            this.updateFilter();\r\n            store.addFilter(this.filter);\r\n        }\r\n        SpaceStore.instance.on(UPDATE_SELECTED_SPACE, this.onSelectedSpaceUpdated);\r\n        SpaceStore.instance.on(UPDATE_HOME_BEHAVIOUR, this.onHomeBehaviourUpdated);\r\n    }\r\n\r\n    private static needsFilter(spaceKey: SpaceKey, allRoomsInHome: boolean): boolean {\r\n        return !(spaceKey === MetaSpace.Home && allRoomsInHome);\r\n    }\r\n\r\n    private onSelectedSpaceUpdated = (activeSpace: SpaceKey, allRoomsInHome = this.allRoomsInHome): void => {\r\n        if (activeSpace === this.activeSpace && allRoomsInHome === this.allRoomsInHome) return; // nop\r\n\r\n        const neededFilter = SpaceWatcher.needsFilter(this.activeSpace, this.allRoomsInHome);\r\n        const needsFilter = SpaceWatcher.needsFilter(activeSpace, allRoomsInHome);\r\n\r\n        this.activeSpace = activeSpace;\r\n        this.allRoomsInHome = allRoomsInHome;\r\n\r\n        if (needsFilter) {\r\n            this.updateFilter();\r\n        }\r\n\r\n        if (!neededFilter && needsFilter) {\r\n            this.store.addFilter(this.filter);\r\n        } else if (neededFilter && !needsFilter) {\r\n            this.store.removeFilter(this.filter);\r\n        }\r\n    };\r\n\r\n    private onHomeBehaviourUpdated = (allRoomsInHome: boolean): void => {\r\n        this.onSelectedSpaceUpdated(this.activeSpace, allRoomsInHome);\r\n    };\r\n\r\n    private updateFilter = (): void => {\r\n        this.filter.updateSpace(this.activeSpace);\r\n    };\r\n}\r\n"],"mappings":";;;;;;;;AAiBA,IAAAA,qBAAA,GAAAC,OAAA;AACA,IAAAC,WAAA,GAAAC,sBAAA,CAAAF,OAAA;AACA,IAAAG,OAAA,GAAAH,OAAA;AAnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAOA;AACA;AACA;AACO,MAAMI,YAAY,CAAC;EAMfC,WAAWA,CAASC,KAAgB,EAAE;IAAA,IAAAC,KAAA;IAAA,KAAlBD,KAAgB,GAAhBA,KAAgB;IAAA,IAAAE,gBAAA,CAAAC,OAAA,kBALjB,IAAIC,0CAAoB,CAAC,CAAC;IACpD;IAAA,IAAAF,gBAAA,CAAAC,OAAA,uBACgCE,mBAAU,CAACC,QAAQ,CAACC,WAAW;IAAA,IAAAL,gBAAA,CAAAC,OAAA,0BAC7BE,mBAAU,CAACC,QAAQ,CAACE,cAAc;IAAA,IAAAN,gBAAA,CAAAC,OAAA,kCAenC,UAACI,WAAqB,EAAiD;MAAA,IAA/CC,cAAc,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAGR,KAAI,CAACO,cAAc;MACzF,IAAID,WAAW,KAAKN,KAAI,CAACM,WAAW,IAAIC,cAAc,KAAKP,KAAI,CAACO,cAAc,EAAE,OAAO,CAAC;;MAExF,MAAMI,YAAY,GAAGd,YAAY,CAACe,WAAW,CAACZ,KAAI,CAACM,WAAW,EAAEN,KAAI,CAACO,cAAc,CAAC;MACpF,MAAMK,WAAW,GAAGf,YAAY,CAACe,WAAW,CAACN,WAAW,EAAEC,cAAc,CAAC;MAEzEP,KAAI,CAACM,WAAW,GAAGA,WAAW;MAC9BN,KAAI,CAACO,cAAc,GAAGA,cAAc;MAEpC,IAAIK,WAAW,EAAE;QACbZ,KAAI,CAACa,YAAY,CAAC,CAAC;MACvB;MAEA,IAAI,CAACF,YAAY,IAAIC,WAAW,EAAE;QAC9BZ,KAAI,CAACD,KAAK,CAACe,SAAS,CAACd,KAAI,CAACe,MAAM,CAAC;MACrC,CAAC,MAAM,IAAIJ,YAAY,IAAI,CAACC,WAAW,EAAE;QACrCZ,KAAI,CAACD,KAAK,CAACiB,YAAY,CAAChB,KAAI,CAACe,MAAM,CAAC;MACxC;IACJ,CAAC;IAAA,IAAAd,gBAAA,CAAAC,OAAA,kCAEiCK,cAAuB,IAAW;MAChE,IAAI,CAACU,sBAAsB,CAAC,IAAI,CAACX,WAAW,EAAEC,cAAc,CAAC;IACjE,CAAC;IAAA,IAAAN,gBAAA,CAAAC,OAAA,wBAEsB,MAAY;MAC/B,IAAI,CAACa,MAAM,CAACG,WAAW,CAAC,IAAI,CAACZ,WAAW,CAAC;IAC7C,CAAC;IAtCG,IAAIT,YAAY,CAACe,WAAW,CAAC,IAAI,CAACN,WAAW,EAAE,IAAI,CAACC,cAAc,CAAC,EAAE;MACjE,IAAI,CAACM,YAAY,CAAC,CAAC;MACnBd,KAAK,CAACe,SAAS,CAAC,IAAI,CAACC,MAAM,CAAC;IAChC;IACAX,mBAAU,CAACC,QAAQ,CAACc,EAAE,CAACC,6BAAqB,EAAE,IAAI,CAACH,sBAAsB,CAAC;IAC1Eb,mBAAU,CAACC,QAAQ,CAACc,EAAE,CAACE,6BAAqB,EAAE,IAAI,CAACC,sBAAsB,CAAC;EAC9E;EAEA,OAAeV,WAAWA,CAACW,QAAkB,EAAEhB,cAAuB,EAAW;IAC7E,OAAO,EAAEgB,QAAQ,KAAKC,iBAAS,CAACC,IAAI,IAAIlB,cAAc,CAAC;EAC3D;AA6BJ;AAACmB,OAAA,CAAA7B,YAAA,GAAAA,YAAA"}