{"version":3,"file":"arrays.js","names":["_numbers","require","arrayFastResample","input","points","length","samples","everyNth","Math","round","i","push","spreadFactor","ceil","val","arraySeed","arrayTrimFill","arraySmoothingResample","prevPoint","nextPoint","currPoint","average","arrayRescale","newMin","newMax","min","max","map","v","percentageWithin","percentageOf","Array","fill","a","len","seed","slice","concat","arrayFastClone","arrayHasOrderChange","b","arrayHasDiff","some","includes","arrayDiff","added","filter","removed","arrayIntersection","arrayUnion","_len","arguments","_key","from","reduce","c","forEach","add","Set","moveElement","list","fromIndex","toIndex","result","splice","ArrayUtil","constructor","value","groupBy","fn","obj","rv","k","has","set","get","Map","GroupedArray","exports","orderBy","keyOrder","_len2","arrays","_key2","concatenatedSoFar","toBeConcatenated","concatenated","Uint8Array","asyncEvery","values","predicate","asyncSome","filterBoolean","Boolean"],"sources":["../../src/utils/arrays.ts"],"sourcesContent":["/*\r\nCopyright 2020, 2021 The Matrix.org Foundation C.I.C.\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\n    http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License.\r\n*/\r\n\r\nimport { percentageOf, percentageWithin } from \"./numbers\";\r\n\r\n/**\r\n * Quickly resample an array to have less/more data points. If an input which is larger\r\n * than the desired size is provided, it will be downsampled. Similarly, if the input\r\n * is smaller than the desired size then it will be upsampled.\r\n * @param {number[]} input The input array to resample.\r\n * @param {number} points The number of samples to end up with.\r\n * @returns {number[]} The resampled array.\r\n */\r\nexport function arrayFastResample(input: number[], points: number): number[] {\r\n    if (input.length === points) return input; // short-circuit a complicated call\r\n\r\n    // Heavily inspired by matrix-media-repo (used with permission)\r\n    // https://github.com/turt2live/matrix-media-repo/blob/abe72c87d2e29/util/util_audio/fastsample.go#L10\r\n    const samples: number[] = [];\r\n    if (input.length > points) {\r\n        // Danger: this loop can cause out of memory conditions if the input is too small.\r\n        const everyNth = Math.round(input.length / points);\r\n        for (let i = 0; i < input.length; i += everyNth) {\r\n            samples.push(input[i]);\r\n        }\r\n    } else {\r\n        // Smaller inputs mean we have to spread the values over the desired length. We\r\n        // end up overshooting the target length in doing this, but we're not looking to\r\n        // be super accurate so we'll let the sanity trims do their job.\r\n        const spreadFactor = Math.ceil(points / input.length);\r\n        for (const val of input) {\r\n            samples.push(...arraySeed(val, spreadFactor));\r\n        }\r\n    }\r\n\r\n    // Trim to size & return\r\n    return arrayTrimFill(samples, points, arraySeed(input[input.length - 1], points));\r\n}\r\n\r\n/**\r\n * Attempts a smooth resample of the given array. This is functionally similar to arrayFastResample\r\n * though can take longer due to the smoothing of data.\r\n * @param {number[]} input The input array to resample.\r\n * @param {number} points The number of samples to end up with.\r\n * @returns {number[]} The resampled array.\r\n */\r\n// ts-prune-ignore-next\r\nexport function arraySmoothingResample(input: number[], points: number): number[] {\r\n    if (input.length === points) return input; // short-circuit a complicated call\r\n\r\n    let samples: number[] = [];\r\n    if (input.length > points) {\r\n        // We're downsampling. To preserve the curve we'll actually reduce our sample\r\n        // selection and average some points between them.\r\n\r\n        // All we're doing here is repeatedly averaging the waveform down to near our\r\n        // target value. We don't average down to exactly our target as the loop might\r\n        // never end, and we can over-average the data. Instead, we'll get as far as\r\n        // we can and do a followup fast resample (the neighbouring points will be close\r\n        // to the actual waveform, so we can get away with this safely).\r\n        while (samples.length > points * 2 || samples.length === 0) {\r\n            samples = [];\r\n            for (let i = 1; i < input.length - 1; i += 2) {\r\n                const prevPoint = input[i - 1];\r\n                const nextPoint = input[i + 1];\r\n                const currPoint = input[i];\r\n                const average = (prevPoint + nextPoint + currPoint) / 3;\r\n                samples.push(average);\r\n            }\r\n            input = samples;\r\n        }\r\n\r\n        return arrayFastResample(samples, points);\r\n    } else {\r\n        // In practice there's not much purpose in burning CPU for short arrays only to\r\n        // end up with a result that can't possibly look much different than the fast\r\n        // resample, so just skip ahead to the fast resample.\r\n        return arrayFastResample(input, points);\r\n    }\r\n}\r\n\r\n/**\r\n * Rescales the input array to have values that are inclusively within the provided\r\n * minimum and maximum.\r\n * @param {number[]} input The array to rescale.\r\n * @param {number} newMin The minimum value to scale to.\r\n * @param {number} newMax The maximum value to scale to.\r\n * @returns {number[]} The rescaled array.\r\n */\r\n// ts-prune-ignore-next\r\nexport function arrayRescale(input: number[], newMin: number, newMax: number): number[] {\r\n    const min: number = Math.min(...input);\r\n    const max: number = Math.max(...input);\r\n    return input.map((v) => percentageWithin(percentageOf(v, min, max), newMin, newMax));\r\n}\r\n\r\n/**\r\n * Creates an array of the given length, seeded with the given value.\r\n * @param {T} val The value to seed the array with.\r\n * @param {number} length The length of the array to create.\r\n * @returns {T[]} The array.\r\n */\r\nexport function arraySeed<T>(val: T, length: number): T[] {\r\n    // Size the array up front for performance, and use `fill` to let the browser\r\n    // optimize the operation better than we can with a `for` loop, if it wants.\r\n    return new Array<T>(length).fill(val);\r\n}\r\n\r\n/**\r\n * Trims or fills the array to ensure it meets the desired length. The seed array\r\n * given is pulled from to fill any missing slots - it is recommended that this be\r\n * at least `len` long. The resulting array will be exactly `len` long, either\r\n * trimmed from the source or filled with the some/all of the seed array.\r\n * @param {T[]} a The array to trim/fill.\r\n * @param {number} len The length to trim or fill to, as needed.\r\n * @param {T[]} seed Values to pull from if the array needs filling.\r\n * @returns {T[]} The resulting array of `len` length.\r\n */\r\nexport function arrayTrimFill<T>(a: T[], len: number, seed: T[]): T[] {\r\n    // Dev note: we do length checks because the spread operator can result in some\r\n    // performance penalties in more critical code paths. As a utility, it should be\r\n    // as fast as possible to not cause a problem for the call stack, no matter how\r\n    // critical that stack is.\r\n    if (a.length === len) return a;\r\n    if (a.length > len) return a.slice(0, len);\r\n    return a.concat(seed.slice(0, len - a.length));\r\n}\r\n\r\n/**\r\n * Clones an array as fast as possible, retaining references of the array's values.\r\n * @param a The array to clone. Must be defined.\r\n * @returns A copy of the array.\r\n */\r\nexport function arrayFastClone<T>(a: T[]): T[] {\r\n    return a.slice(0, a.length);\r\n}\r\n\r\n/**\r\n * Determines if the two arrays are different either in length, contents,\r\n * or order of those contents.\r\n * @param a The first array. Must be defined.\r\n * @param b The second array. Must be defined.\r\n * @returns True if they are different, false otherwise.\r\n */\r\nexport function arrayHasOrderChange(a: any[], b: any[]): boolean {\r\n    if (a.length === b.length) {\r\n        for (let i = 0; i < a.length; i++) {\r\n            if (a[i] !== b[i]) return true;\r\n        }\r\n        return false;\r\n    } else {\r\n        return true; // like arrayHasDiff, a difference in length is a natural change\r\n    }\r\n}\r\n\r\n/**\r\n * Determines if two arrays are different through a shallow comparison.\r\n * @param a The first array. Must be defined.\r\n * @param b The second array. Must be defined.\r\n * @returns True if they are different, false otherwise.\r\n */\r\nexport function arrayHasDiff(a: any[], b: any[]): boolean {\r\n    if (a.length === b.length) {\r\n        // When the lengths are equal, check to see if either array is missing\r\n        // an element from the other.\r\n        if (b.some((i) => !a.includes(i))) return true;\r\n        if (a.some((i) => !b.includes(i))) return true;\r\n\r\n        // if all the keys are common, say so\r\n        return false;\r\n    } else {\r\n        return true; // different lengths means they are naturally diverged\r\n    }\r\n}\r\n\r\nexport type Diff<T> = { added: T[]; removed: T[] };\r\n\r\n/**\r\n * Performs a diff on two arrays. The result is what is different with the\r\n * first array (`added` in the returned object means objects in B that aren't\r\n * in A). Shallow comparisons are used to perform the diff.\r\n * @param a The first array. Must be defined.\r\n * @param b The second array. Must be defined.\r\n * @returns The diff between the arrays.\r\n */\r\nexport function arrayDiff<T>(a: T[], b: T[]): Diff<T> {\r\n    return {\r\n        added: b.filter((i) => !a.includes(i)),\r\n        removed: a.filter((i) => !b.includes(i)),\r\n    };\r\n}\r\n\r\n/**\r\n * Returns the intersection of two arrays.\r\n * @param a The first array. Must be defined.\r\n * @param b The second array. Must be defined.\r\n * @returns The intersection of the arrays.\r\n */\r\nexport function arrayIntersection<T>(a: T[], b: T[]): T[] {\r\n    return a.filter((i) => b.includes(i));\r\n}\r\n\r\n/**\r\n * Unions arrays, deduping contents using a Set.\r\n * @param a The arrays to merge.\r\n * @returns The union of all given arrays.\r\n */\r\nexport function arrayUnion<T>(...a: T[][]): T[] {\r\n    return Array.from(\r\n        a.reduce((c, v) => {\r\n            v.forEach((i) => c.add(i));\r\n            return c;\r\n        }, new Set<T>()),\r\n    );\r\n}\r\n\r\n/**\r\n * Moves a single element from fromIndex to toIndex.\r\n * @param {array} list the list from which to construct the new list.\r\n * @param {number} fromIndex the index of the element to move.\r\n * @param {number} toIndex the index of where to put the element.\r\n * @returns {array} A new array with the requested value moved.\r\n */\r\nexport function moveElement<T>(list: T[], fromIndex: number, toIndex: number): T[] {\r\n    const result = Array.from(list);\r\n    const [removed] = result.splice(fromIndex, 1);\r\n    result.splice(toIndex, 0, removed);\r\n\r\n    return result;\r\n}\r\n\r\n/**\r\n * Helper functions to perform LINQ-like queries on arrays.\r\n */\r\nexport class ArrayUtil<T> {\r\n    /**\r\n     * Create a new array helper.\r\n     * @param a The array to help. Can be modified in-place.\r\n     */\r\n    public constructor(private a: T[]) {}\r\n\r\n    /**\r\n     * The value of this array, after all appropriate alterations.\r\n     */\r\n    public get value(): T[] {\r\n        return this.a;\r\n    }\r\n\r\n    /**\r\n     * Groups an array by keys.\r\n     * @param fn The key-finding function.\r\n     * @returns This.\r\n     */\r\n    public groupBy<K>(fn: (a: T) => K): GroupedArray<K, T> {\r\n        const obj = this.a.reduce((rv: Map<K, T[]>, val: T) => {\r\n            const k = fn(val);\r\n            if (!rv.has(k)) rv.set(k, []);\r\n            rv.get(k)!.push(val);\r\n            return rv;\r\n        }, new Map<K, T[]>());\r\n        return new GroupedArray(obj);\r\n    }\r\n}\r\n\r\n/**\r\n * Helper functions to perform LINQ-like queries on groups (maps).\r\n */\r\nexport class GroupedArray<K, T> {\r\n    /**\r\n     * Creates a new group helper.\r\n     * @param val The group to help. Can be modified in-place.\r\n     */\r\n    public constructor(private val: Map<K, T[]>) {}\r\n\r\n    /**\r\n     * The value of this group, after all applicable alterations.\r\n     */\r\n    public get value(): Map<K, T[]> {\r\n        return this.val;\r\n    }\r\n\r\n    /**\r\n     * Orders the grouping into an array using the provided key order.\r\n     * @param keyOrder The key order.\r\n     * @returns An array helper of the result.\r\n     */\r\n    public orderBy(keyOrder: K[]): ArrayUtil<T> {\r\n        const a: T[] = [];\r\n        for (const k of keyOrder) {\r\n            if (!this.val.has(k)) continue;\r\n            a.push(...this.val.get(k)!);\r\n        }\r\n        return new ArrayUtil(a);\r\n    }\r\n}\r\n\r\nexport const concat = (...arrays: Uint8Array[]): Uint8Array => {\r\n    return arrays.reduce((concatenatedSoFar: Uint8Array, toBeConcatenated: Uint8Array) => {\r\n        const concatenated = new Uint8Array(concatenatedSoFar.length + toBeConcatenated.length);\r\n        concatenated.set(concatenatedSoFar, 0);\r\n        concatenated.set(toBeConcatenated, concatenatedSoFar.length);\r\n        return concatenated;\r\n    }, new Uint8Array(0));\r\n};\r\n\r\n/**\r\n * Async version of Array.every.\r\n */\r\nexport async function asyncEvery<T>(values: Iterable<T>, predicate: (value: T) => Promise<boolean>): Promise<boolean> {\r\n    for (const value of values) {\r\n        if (!(await predicate(value))) return false;\r\n    }\r\n    return true;\r\n}\r\n\r\n/**\r\n * Async version of Array.some.\r\n */\r\nexport async function asyncSome<T>(values: Iterable<T>, predicate: (value: T) => Promise<boolean>): Promise<boolean> {\r\n    for (const value of values) {\r\n        if (await predicate(value)) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nexport function filterBoolean<T>(values: Array<T | null | undefined>): T[] {\r\n    return values.filter(Boolean) as T[];\r\n}\r\n"],"mappings":"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"}