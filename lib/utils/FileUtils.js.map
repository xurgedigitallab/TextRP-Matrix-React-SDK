{"version":3,"file":"FileUtils.js","names":["_filesize","require","_languageHandler","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty2","default","getOwnPropertyDescriptors","defineProperties","defineProperty","presentableTextForFile","content","fallbackText","undefined","_t","withSize","shortened","text","body","parts","split","fileName","slice","join","substring","extension","replace","info","size","fileSize","base","standard","options","defaultOption","filesize"],"sources":["../../src/utils/FileUtils.ts"],"sourcesContent":["/*\r\nCopyright 2015 - 2021 The Matrix.org Foundation C.I.C.\r\nCopyright 2021 Å imon Brandner <simon.bra.ag@gmail.com>\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\n    http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License.\r\n*/\r\n\r\nimport { filesize } from \"filesize\";\r\n\r\nimport { IMediaEventContent } from \"../customisations/models/IMediaEventContent\";\r\nimport { _t } from \"../languageHandler\";\r\n\r\n/**\r\n * Extracts a human readable label for the file attachment to use as\r\n * link text.\r\n *\r\n * @param {IMediaEventContent} content The \"content\" key of the matrix event.\r\n * @param {string} fallbackText The fallback text\r\n * @param {boolean} withSize Whether to include size information. Default true.\r\n * @param {boolean} shortened Ensure the extension of the file name is visible. Default false.\r\n * @return {string} the human readable link text for the attachment.\r\n */\r\nexport function presentableTextForFile(\r\n    content: IMediaEventContent,\r\n    fallbackText = _t(\"Attachment\"),\r\n    withSize = true,\r\n    shortened = false,\r\n): string {\r\n    let text = fallbackText;\r\n    if (content.body?.length) {\r\n        // The content body should be the name of the file including a\r\n        // file extension.\r\n        text = content.body;\r\n    }\r\n\r\n    // We shorten to 15 characters somewhat arbitrarily, and assume most files\r\n    // will have a 3 character (plus full stop) extension. The goal is to knock\r\n    // the label down to 15-25 characters, not perfect accuracy.\r\n    if (shortened && text.length > 19) {\r\n        const parts = text.split(\".\");\r\n        let fileName = parts\r\n            .slice(0, parts.length - 1)\r\n            .join(\".\")\r\n            .substring(0, 15);\r\n        const extension = parts[parts.length - 1];\r\n\r\n        // Trim off any full stops from the file name to avoid a case where we\r\n        // add an ellipsis that looks really funky.\r\n        fileName = fileName.replace(/\\.*$/g, \"\");\r\n\r\n        text = `${fileName}...${extension}`;\r\n    }\r\n\r\n    if (content.info?.size && withSize) {\r\n        // If we know the size of the file then add it as human readable\r\n        // string to the end of the link text so that the user knows how\r\n        // big a file they are downloading.\r\n        // The content.info also contains a MIME-type but we don't display\r\n        // it since it is \"ugly\", users generally aren't aware what it\r\n        // means and the type of the attachment can usually be inferred\r\n        // from the file extension.\r\n        text += \" (\" + <string>fileSize(content.info.size, { base: 2, standard: \"jedec\" }) + \")\";\r\n    }\r\n    return text;\r\n}\r\n\r\n/**\r\n * wrapper function to set default values for filesize function\r\n *\r\n * @param size size of file\r\n * @param options options to customize the response type or size type conversion e.g. 12kB, 12KB\r\n * @returns {string | number | any[] | {\r\n *  value: any;\r\n *  symbol: any;\r\n *  exponent: number;\r\n *  unit: string;}} formatted file size with unit e.g. 12kB, 12KB\r\n */\r\nexport function fileSize(\r\n    size: Parameters<typeof filesize>[0],\r\n    options?: Parameters<typeof filesize>[1],\r\n): ReturnType<typeof filesize> {\r\n    const defaultOption: Parameters<typeof filesize>[1] = { base: 2, standard: \"jedec\", ...options };\r\n    return filesize(size, defaultOption);\r\n}\r\n"],"mappings":"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"}