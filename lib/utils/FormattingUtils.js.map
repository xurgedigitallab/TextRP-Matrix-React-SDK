{"version":3,"file":"FormattingUtils.js","names":["_languageHandler","require","_ReactUtils","formatCount","count","toString","toFixed","formatCountLong","formatter","Intl","NumberFormat","format","formatBytes","bytes","decimals","arguments","length","undefined","k","dm","sizes","i","Math","floor","log","parseFloat","pow","formatCryptoKey","key","match","join","hashCode","str","hash","chr","charCodeAt","abs","getUserNameColorClass","userId","colorNumber","formatCommaSeparatedList","items","itemLimit","remaining","max","lastItem","slice","pop","joinedItems","every","e","jsxJoin","_t"],"sources":["../../src/utils/FormattingUtils.ts"],"sourcesContent":["/*\r\nCopyright 2016 OpenMarket Ltd\r\nCopyright 2019, 2020 The Matrix.org Foundation C.I.C.\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\n    http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License.\r\n*/\r\n\r\nimport { ReactElement, ReactNode } from \"react\";\r\n\r\nimport { _t } from \"../languageHandler\";\r\nimport { jsxJoin } from \"./ReactUtils\";\r\n\r\n/**\r\n * formats numbers to fit into ~3 characters, suitable for badge counts\r\n * e.g: 999, 9.9K, 99K, 0.9M, 9.9M, 99M, 0.9B, 9.9B\r\n */\r\nexport function formatCount(count: number): string {\r\n    if (count < 1000) return count.toString();\r\n    if (count < 10000) return (count / 1000).toFixed(1) + \"K\";\r\n    if (count < 100000) return (count / 1000).toFixed(0) + \"K\";\r\n    if (count < 10000000) return (count / 1000000).toFixed(1) + \"M\";\r\n    if (count < 100000000) return (count / 1000000).toFixed(0) + \"M\";\r\n    return (count / 1000000000).toFixed(1) + \"B\"; // 10B is enough for anyone, right? :S\r\n}\r\n\r\n/**\r\n * Format a count showing the whole number but making it a bit more readable.\r\n * e.g: 1000 => 1,000\r\n */\r\nexport function formatCountLong(count: number): string {\r\n    const formatter = new Intl.NumberFormat();\r\n    return formatter.format(count);\r\n}\r\n\r\n/**\r\n * format a size in bytes into a human readable form\r\n * e.g: 1024 -> 1.00 KB\r\n */\r\nexport function formatBytes(bytes: number, decimals = 2): string {\r\n    if (bytes === 0) return \"0 Bytes\";\r\n\r\n    const k = 1024;\r\n    const dm = decimals < 0 ? 0 : decimals;\r\n    const sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\", \"TB\", \"PB\", \"EB\", \"ZB\", \"YB\"];\r\n\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n\r\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + \" \" + sizes[i];\r\n}\r\n\r\n/**\r\n * format a key into groups of 4 characters, for easier visual inspection\r\n *\r\n * @param {string} key key to format\r\n *\r\n * @return {string}\r\n */\r\nexport function formatCryptoKey(key: string): string {\r\n    return key.match(/.{1,4}/g)!.join(\" \");\r\n}\r\n/**\r\n * calculates a numeric hash for a given string\r\n *\r\n * @param {string} str string to hash\r\n *\r\n * @return {number}\r\n */\r\nexport function hashCode(str?: string): number {\r\n    let hash = 0;\r\n    let chr: number;\r\n    if (!str?.length) {\r\n        return hash;\r\n    }\r\n    for (let i = 0; i < str.length; i++) {\r\n        chr = str.charCodeAt(i);\r\n        hash = (hash << 5) - hash + chr;\r\n        hash |= 0;\r\n    }\r\n    return Math.abs(hash);\r\n}\r\n\r\nexport function getUserNameColorClass(userId?: string): string {\r\n    const colorNumber = (hashCode(userId) % 8) + 1;\r\n    return `mx_Username_color${colorNumber}`;\r\n}\r\n\r\n/**\r\n * Constructs a written English string representing `items`, with an optional\r\n * limit on the number of items included in the result. If specified and if the\r\n * length of `items` is greater than the limit, the string \"and n others\" will\r\n * be appended onto the result. If `items` is empty, returns the empty string.\r\n * If there is only one item, return it.\r\n * @param {string[]} items the items to construct a string from.\r\n * @param {number?} itemLimit the number by which to limit the list.\r\n * @returns {string} a string constructed by joining `items` with a comma\r\n * between each item, but with the last item appended as \" and [lastItem]\".\r\n */\r\nexport function formatCommaSeparatedList(items: string[], itemLimit?: number): string;\r\nexport function formatCommaSeparatedList(items: ReactElement[], itemLimit?: number): ReactElement;\r\nexport function formatCommaSeparatedList(items: ReactNode[], itemLimit?: number): ReactNode;\r\nexport function formatCommaSeparatedList(items: ReactNode[], itemLimit?: number): ReactNode {\r\n    const remaining = itemLimit === undefined ? 0 : Math.max(items.length - itemLimit, 0);\r\n    if (items.length === 0) {\r\n        return \"\";\r\n    } else if (items.length === 1) {\r\n        return items[0];\r\n    } else {\r\n        let lastItem;\r\n        if (remaining > 0) {\r\n            items = items.slice(0, itemLimit);\r\n        } else {\r\n            lastItem = items.pop();\r\n        }\r\n\r\n        let joinedItems;\r\n        if (items.every((e) => typeof e === \"string\")) {\r\n            joinedItems = items.join(\", \");\r\n        } else {\r\n            joinedItems = jsxJoin(items, \", \");\r\n        }\r\n\r\n        if (remaining > 0) {\r\n            return _t(\"%(items)s and %(count)s others\", { items: joinedItems, count: remaining });\r\n        } else {\r\n            return _t(\"%(items)s and %(lastItem)s\", { items: joinedItems, lastItem });\r\n        }\r\n    }\r\n}\r\n"],"mappings":"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"}